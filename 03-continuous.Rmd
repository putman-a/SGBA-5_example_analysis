# SGBA of a Continuous Variable {#continuous}

```{r setup-03-continuous, include=FALSE}
# load libraries and simulated data ---------------------------------------

library(tidyverse)
library(ggpubr)
library(extrafont)  # for exporting plots with Times New Roman Font

# set seed for reproducibility
set.seed(42)

# load data set (from RDS if using previous script to simulate the data)
sim_data <- read_csv(file = "sim-data.csv")

# store plot theme preset -------------------------------------------------

# store axis options for gender variable plots
gender_plot_theme <-   
  theme_classic() +
  theme(
#    text = element_text(family = 'serif'),
    legend.position = 'none',
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank()
  )

# default density plots and scale
plot_dens_2D <- function(data, x, y){
  plot <- ggplot(data = data, aes(x = x, y = y)) + 
    geom_density_2d_filled(aes(fill = after_stat(level)),
                           bins = 9, contour_var = 'ndensity') +
    scale_fill_brewer(palette = 16, direction = 1, 
                      labels = c('Low', '', '', '','','','','', 'High')) +
    guides(fill = guide_legend(title = 'Density of Occurences', 
                               direction = 'horizontal', nrow = 1, 
                               label.position = 'bottom'))
  plot
}
```

> *Note 1: for conciseness, the following examples will only show results for two of the four gendered aspects of health items from the SGBA-5 (gender identity, and gender roles)*

> *Note 2: for each of the following sections, an example outcome variable that demonstrates a relationship between that variable and the SGBA-5 item being assessed - the interaction example - and an example that does not demonstrate a relationship between itself and the SGBA-5 item - the no interaction example - are shown.*


## Biological Sex

A good idea is to start by visualizing the continuous variable’s distribution disaggregated by sex like the density plot in Figure \@ref(fig:04-binary-pos-plot). Then calculate disaggregated summary statistics for the continuous variable disaggregated by sex (Tables \@ref(tab:03-tab-int) and  \@ref(tab:03-tab-no-int)), and conduct a statistical test of difference in means (Welch’s t-test for this example).


### Density Plots

```{r 04-binary-pos-plot, fig.cap="Density Plot of Continuous Variable by Biological Sex Examples", fig.width=3.5, fig.height=3.5, fig.align='center',fig.show='hold', out.width = '50%', echo=FALSE}

# biological sex bar plot
ggplot(sim_data, aes(x = outcome_num_pos_sex, fill = bio_sex)) + 
  geom_density(alpha = 0.7) +
  scale_fill_manual(values = c('forestgreen', 'skyblue')) +
  labs(
    title = 'Interaction example',
    subtitle = 'Density plot of continuous \noutcome and biological sex (n=30)'
    ) +
  xlab('Continuous Outcome') + 
  ylab('Response Density') +
  theme_classic() +
  theme(legend.position = 'bottom')

# biological sex bar plot
ggplot(sim_data, aes(x = outcome_num_neg, fill = bio_sex)) + 
  geom_density(alpha = 0.7) +
  scale_fill_manual(values = c('forestgreen', 'skyblue')) +
  labs(
    title = 'No interaction example',
    subtitle = 'Density plot of continuous \noutcome and biological sex (n=30)'
    ) +
  xlab('Continuous Outcome') + 
  ylab('Response Density') +
  theme_classic() +
  theme(legend.position = 'bottom')
```

**Interpretation:** From the above density plots (Figure \@ref(fig:04-binary-pos-plot)) we can see a distinct overlap in the **no interaction example** with suggests that in that example's sample does not have a meaningful difference in the continuous outcome by sex. Conversely, the **interaction example** density plot has two distinct peaks which suggests that its sample's continuous outcome scores are associated with a participant's sex.


### Summary Statistics

``` {r 03-tab-int, echo=FALSE}
# summary stats
pos_cont_sex_sum <- sim_data %>% group_by(bio_sex) %>% 
  summarise(
    n = n(), 
    `mean continuous` = round(mean(outcome_num_pos_sex),1),
    `SD continuous` = round(sd(outcome_num_pos_sex),2),
    `median continuous` = round(median(outcome_num_pos_sex),0),
    `IQR continuous` = round(IQR(outcome_num_pos_sex),)
  ) %>% 
  rename(`biological sex` = bio_sex) 

knitr::kable(pos_cont_sex_sum, booktabs = TRUE, caption = "Interation example summary statisitics: Continuous outcome and biological sex")
```

``` {r 03-tab-no-int, echo=FALSE}
# summary stats
neg_cont_sex_sum <- sim_data %>% group_by(bio_sex) %>% 
  summarise(
    n = n(), 
    `mean continuous` = round(mean(outcome_num_neg),1),
    `SD continuous` = round(sd(outcome_num_neg),2),
    `median continuous` = round(median(outcome_num_neg),0),
    `IQR continuous` = round(IQR(outcome_num_neg),)
  ) %>% 
  rename(`biological sex` = bio_sex) 

knitr::kable(neg_cont_sex_sum, booktabs = TRUE, caption = "No interation example summary statisitics: Continuous outcome and biological sex")
```

**Interpretation:** As with the density plots, we see that the standard deviations of the continuous variable for both males and females overlap in the **no interaction example** (Table \@ref(tab:03-tab-int)) - indicating a lack of significant difference by sex. The standard deviations of the continuous variable for both males and females do not overlap in the **interaction example** (Table \@ref(tab:03-tab-no-int)) - indicating a potential association between that continuous outcome variable and sex.


### Statistical Test

**No interaction: Welch's t-test**
``` {r, echo=FALSE}
con_sex_ttest_neg <- t.test(outcome_num_neg ~ bio_sex, data = sim_data)
con_sex_ttest_pos <- t.test(outcome_num_pos_sex ~ bio_sex, data = sim_data)

# example of collected data
con_sex_tab <- tibble(
  "Example" = c("Interaction", "No interaction"),
  "Test" = c("Welch's t-test", "Welch's t-test"),
  "T-score" = c(
    round(con_sex_ttest_pos$statistic,2),
    round(con_sex_ttest_neg$statistic,2)
  ),
  "95% CI" = c(
    paste0(
      "(", 
      round(con_sex_ttest_pos$conf.int[[1]],2), 
      ", ",  
      round(con_sex_ttest_pos$conf.int[[2]],2), 
      ")", sep = ""
    ),
    paste0(
      "(", 
      round(con_sex_ttest_neg$conf.int[[1]],2),
      ", ", 
      round(con_sex_ttest_neg$conf.int[[2]],2), 
      ")", sep = ""
    )
  ),
  "df" = c(
    round(con_sex_ttest_pos$parameter,1), 
    round(con_sex_ttest_neg$parameter,1)
  ),
  "p-value" = c(
    round(con_sex_ttest_pos$p.value, 3),
    round(con_sex_ttest_neg$p.value,3)
  )
)

knitr::kable(con_sex_tab, booktabs = TRUE, caption = "Statistical test of difference: Continuous outcome and biological sex.")
```

